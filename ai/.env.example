########################################
# Digi Notes - AI service environment example
########################################

# Server / runtime
ENVIRONMENT=development
HOST=0.0.0.0
PORT=8000
# WORKERS: for process managers (uvicorn/gunicorn) â€” tune to CPU cores
WORKERS=4

########################################
# Backend integration
########################################
BACKEND_URL=http://backend:5000
BACKEND_API_KEY=

########################################
# AWS / S3
########################################
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your_aws_access_key
AWS_SECRET_ACCESS_KEY=your_aws_secret_key
AWS_S3_BUCKET=digi-notes-uploads

# Local S3 temp and download settings
S3_DOWNLOAD_TIMEOUT=300
S3_TEMP_DIR=/app/data/temp

########################################
# Textract (optional)
########################################
AWS_TEXTRACT_ENABLED=true
AWS_TEXTRACT_MAX_PAGES=10
AWS_TEXTRACT_TIMEOUT=60
AWS_TEXTRACT_RETRY_ATTEMPTS=3

########################################
# Neptune (knowledge graph)
########################################
# Provide endpoint like: https://your-neptune-host
NEPTUNE_ENDPOINT=
NEPTUNE_PORT=8182
NEPTUNE_USE_IAM=false

########################################
# OpenAI / LLM provider
########################################
# Use cost-control settings (temperature, max tokens) to manage expense.
OPENAI_API_KEY=sk-your-openai-api-key
OPENAI_MODEL=gpt-4
OPENAI_MAX_TOKENS=2000
OPENAI_TEMPERATURE=0.7
OPENAI_TIMEOUT=60
OPENAI_RETRY_ATTEMPTS=3
OPENAI_RETRY_MAX_WAIT=10
OPENAI_RETRY_MULTIPLIER=2
LLM_PARSER_MAX_TEXT_LENGTH=50000
LLM_PARSER_ENABLE_COST_TRACKING=true

########################################
# Local / alternative LLMs
########################################
LLM_PROVIDER=openai
ANTHROPIC_API_KEY=
LOCAL_MODEL_PATH=

########################################
# TrOCR (OCR model)
########################################
# TROCR_DEVICE: 'cpu' (default) or 'cuda' for GPU. On GPU, ensure drivers and CUDA are installed.
TROCR_MODEL=microsoft/trocr-large-handwritten
TROCR_DEVICE=cpu
TROCR_BATCH_SIZE=4
TROCR_MAX_LENGTH=512

########################################
# Model cache and disk space
########################################
# Transformers cache and HF/Torch dirs should have ample free space for models.
# Recommended: >= 10GB free for larger models; 1-2GB minimum for small models.
TRANSFORMERS_CACHE=/app/models
HF_HOME=/app/models
TORCH_HOME=/app/models

########################################
# Processing limits and thresholds
########################################
MAX_IMAGE_SIZE_MB=10
SUPPORTED_IMAGE_FORMATS=jpg,jpeg,png,pdf
OCR_CONFIDENCE_THRESHOLD=0.7
PREPROCESSING_ENABLED=true
PREPROCESSING_DENOISE=true
PREPROCESSING_THRESHOLD=true
PREPROCESSING_DESKEW=true
MIN_IMAGE_DIMENSION=50
MAX_IMAGE_DIMENSION=10000

########################################
# CORS, shutdown, readiness
########################################
CORS_ORIGIN=http://localhost:3000,http://frontend:3000
SHUTDOWN_TIMEOUT_MS=15000
REDIS_REQUIRED_FOR_READY=false

########################################
# Logging
########################################
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE_PATH=./logs/ai-service.log
OPENAI_REQUIRED_FOR_READY=false

########################################
# Redis and task manager
########################################
REDIS_HOST=redis
REDIS_PORT=6379
TASK_TTL_SECONDS=86400
TASK_MANAGER_ENABLED=true
REDIS_PASSWORD=
REDIS_CACHE_ENABLED=true
PROCESS_NOTE_TIMEOUT=300
PROCESS_NOTE_ENABLE_FLASHCARDS=true
PROCESS_NOTE_ENABLE_GRAPH=true
PROCESS_NOTE_FLASHCARD_COUNT=10
PROCESS_NOTE_CONTINUE_ON_ERROR=true
REDIS_CACHE_TTL=3600

########################################
# LLM tuning defaults (summaries, flashcards, quizzes)
########################################
SUMMARIZER_BRIEF_MAX_TOKENS=500
SUMMARIZER_DETAILED_MAX_TOKENS=1500
SUMMARIZER_TEMPERATURE=0.3
FLASHCARD_MAX_TOKENS=1500
FLASHCARD_TEMPERATURE=0.5
FLASHCARD_MIN_COUNT=5
FLASHCARD_MAX_COUNT=50
QUIZ_MAX_TOKENS=2000
QUIZ_TEMPERATURE=0.5
QUIZ_MAX_QUESTIONS=20
MINDMAP_MAX_TOKENS=2000
MINDMAP_TEMPERATURE=0.4

########################################
# Database (Postgres)
########################################
DB_HOST=postgres
DB_PORT=5432
DB_NAME=digi_notes
DB_USER=postgres
DB_PASSWORD=your_secure_password_here

# Notes: copy to ai/.env and secure secrets. For GPU deployments, set TROCR_DEVICE=cuda and ensure
# the container/runtime has access to the GPU and proper drivers. Monitor model cache disk usage.
