########################################
# Digi Notes - Backend environment example
########################################

# Server settings
# NODE_ENV: development | production
NODE_ENV=development
# PORT: The port the backend listens on (container/default: 5000)
PORT=5000
HOST=0.0.0.0

########################################
# Database (Postgres)
########################################
DB_HOST=postgres
DB_PORT=5432
DB_NAME=digi_notes
DB_USER=postgres
DB_PASSWORD=your_secure_password_here
DB_POOL_MIN=2
DB_POOL_MAX=10

# Optional single URL alternative for some tools
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE
DATABASE_URL=postgresql://postgres:your_secure_password_here@postgres:5432/digi_notes

########################################
# Caching (Redis)
########################################
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_TTL=3600

########################################
# Authentication (JWT)
########################################
# Use long, random values for secrets in production (>=32 chars). Keep secrets out of VCS.
JWT_SECRET=your_jwt_secret_key_min_32_chars
JWT_EXPIRES_IN=15m
JWT_REFRESH_SECRET=your_refresh_token_secret_min_32_chars
JWT_REFRESH_EXPIRES_IN=30d
JWT_ISSUER=digi-notes
JWT_AUDIENCE=digi-notes-api

########################################
# AWS / S3
########################################
# Used for file uploads and (optionally) Textract
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your_aws_access_key
AWS_SECRET_ACCESS_KEY=your_aws_secret_key
AWS_S3_BUCKET=digi-notes-uploads
AWS_S3_PRESIGNED_URL_EXPIRY=3600

# S3 upload constraints
MAX_FILE_SIZE_MB=10
ALLOWED_FILE_TYPES=image/jpeg,image/png,application/pdf
ALLOWED_FILE_EXTENSIONS=.jpg,.jpeg,.png,.pdf
S3_KEY_PREFIX=notes

########################################
# AI service proxy
########################################
# Backend forwards requests to the AI microservice. Use a full URL here in dev or prod.
AI_SERVICE_URL=http://ai:8000
AI_SERVICE_TIMEOUT=60000

########################################
# Logging
########################################
# LOG_FILE_PATH: file path or directory writable by the process. In production use an absolute path.
LOG_LEVEL=info
LOG_FILE_PATH=./logs/digi-backend.log
LOG_MAX_SIZE=10m
LOG_MAX_FILES=7

########################################
# CORS & Rate-limiting
########################################
# CORS_ORIGIN: comma-separated list of allowed origins. For dev: http://localhost:3000
# Include Vite dev server default port 5173 for frontend dev workflow
CORS_ORIGIN=http://localhost:3000,http://localhost:5173,http://localhost:19006
# RATE_LIMIT_WINDOW_MS: window in ms
# RATE_LIMIT_MAX_REQUESTS: max requests in window
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

########################################
# Password policy
########################################
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SPECIAL=false

# For local development/testing, you can relax requirements by overriding these flags in your local `backend/.env`:
# PASSWORD_REQUIRE_UPPERCASE=false
# PASSWORD_REQUIRE_LOWERCASE=false
# PASSWORD_REQUIRE_NUMBERS=false
# PASSWORD_MIN_LENGTH=6

# Production recommendation: Keep all flags enabled and set PASSWORD_MIN_LENGTH>=12

########################################
# Validation / Sanitization
########################################
VALIDATION_MAX_BODY_SIZE=10mb
VALIDATION_STRICT_MODE=true
SANITIZE_HTML=true
SANITIZE_SQL=true

########################################
# Auth rate limiting (login/refresh endpoints)
########################################
AUTH_RATE_LIMIT_WINDOW_MS=900000
AUTH_RATE_LIMIT_MAX_REQUESTS=5

# Security: generate strong secrets for production. Example:
# node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# Copy this file to `backend/.env` and *never* commit real secrets to version control.
